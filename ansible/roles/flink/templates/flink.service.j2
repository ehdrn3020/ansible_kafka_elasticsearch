[Unit]
Description=Apache Flink {{ 'JobManager' if (inventory_hostname in groups['flink_masters_host']) else 'TaskManager' }}
After=network.target

[Service]
Type=simple
User={{ flink_user }}
Group={{ flink_group }}
Environment=JAVA_HOME={{ java_home }}
Environment=FLINK_HOME={{ flink_home }}
Environment=FLINK_CONF_DIR={{ flink_home }}/conf
Environment="JAVA_OPTS=-javaagent:{{ jmx_exporter_dir }}/{{ jmx_exporter_file_name }}={{ jmx_exporter_flink_port }}:{{ jmx_exporter_dir }}/flink.yml"
WorkingDirectory={{ flink_home }}

{% if inventory_hostname in groups['flink_masters_host'] %}
# JM
ExecStart={{ flink_home }}/bin/jobmanager.sh start-foreground
{% else %}
# TM
ExecStart={{ flink_home }}/bin/taskmanager.sh start-foreground
{% endif %}

Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target
