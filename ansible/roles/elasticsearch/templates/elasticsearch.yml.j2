# ======================== Elasticsearch Configuration =========================
# Elasticsearch 7.17.29 Configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

# ---------------------------------- Cluster -----------------------------------
cluster.name: {{ elasticsearch_cluster_name }}

# ------------------------------------ Node ------------------------------------
node.name: {{ ansible_host }}
node.data: true
node.master: true
node.ingest: true

# ----------------------------------- Paths ------------------------------------
path.data: {{ elasticsearch_data_dir }}
path.logs: {{ elasticsearch_log_dir }}

# ---------------------------------- Network -----------------------------------
# 각 노드의 내부 IP 주소로 바인딩
network.host: {{ ansible_host }}
http.port: {{ elasticsearch_http_port }}
transport.port: {{ elasticsearch_transport_port }}

# --------------------------------- Discovery ----------------------------------
discovery.seed_hosts: [{% for host in groups[elasticsearch_host_group] %}"{{ hostvars[host]['ansible_host'] }}:{{ elasticsearch_transport_port }}"{% if not loop.last %}, {% endif %}{% endfor %}]
cluster.initial_master_nodes: [{% for host in groups[elasticsearch_host_group] %}"{{ hostvars[host]['ansible_host'] }}"{% if not loop.last %}, {% endif %}{% endfor %}]

# ---------------------------------- Gateway -----------------------------------
gateway.recover_after_nodes: 2
gateway.expected_nodes: 3
gateway.recover_after_time: 5m

# ---------------------------------- Memory -----------------------------------
bootstrap.memory_lock: false

# ---------------------------------- X-Pack ------------------------------------
xpack.security.enabled: false
xpack.monitoring.collection.enabled: false
xpack.watcher.enabled: false
xpack.ml.enabled: false

# ---------------------------------- Performance ---------------------------
indices.memory.index_buffer_size: 10%
indices.queries.cache.size: 5%
indices.fielddata.cache.size: 5%

# ---------------------------------- Thread Pool ---------------------------
thread_pool.write.queue_size: 200
thread_pool.search.queue_size: 500

# ---------------------------------- Custom Settings -----------------------
# Minimal resource configuration for development/testing
cluster.routing.allocation.disk.watermark.low: 85%
cluster.routing.allocation.disk.watermark.high: 90%
cluster.routing.allocation.disk.watermark.flood_stage: 95%

# Security and monitoring
action.auto_create_index: true